pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

--
-- game loop.
--

function _init()
end

do
  local g

  function _init()
    g = game()
  end

  function _update60()
    g = game_update(g)
  end

  function _draw()
    game_draw(g)
  end
end

--
-- game entity.
--

function game()
  return {
    airship = airship(0, 0, 10, 9)
  }
end

function game_update(g)
  g.airship = airship_update(g.airship)
  return g
end

function game_draw(g)
  cls(13)
  airship_draw(g.airship)
  -- todo: parallax scrolling
end

--
-- tile entity.
--

function airship(cel_x, cel_y, cel_x2, cel_y2)
  local a  = {}
  a.pos    = vec2()
  a.cel_x  = cel_x
  a.cel_y  = cel_y
  a.cel_x2 = cel_x2
  a.cel_y2 = cel_y2
  a.bounds = bounds(a)
  return a
end

-- cell to world coordinates
function airship_bounds(a)
  return a.cel_x*8, a.cel_y*8, (a.cel_x2+1)*8-1, (a.cel_y2+1)*8-1
end

function airship_update(a)
  if btn(0) then
    a.pos.x -= 1
  end

  if btn(1) then
    a.pos.x += 1
  end

  if btn(2) then
    a.pos.y -= 1
  end

  if btn(3) then
    a.pos.y += 1
  end

  return a
end

function airship_draw(a)
  map(a.cel_x, a.cel_y, a.pos.x, a.pos.y, a.cel_x2-a.cel_x+1, a.cel_y2-a.cel_y+1)
end

--
-- vec2 util.
--

function vec2(x, y)
  return {
    x = x or 0,
    y = y or 0,
  }
end

--
-- bounds util.
--

function bounds(entity)
  return function()
    local dx = entity.cel_w * 8
    local dy = entity.cel_h * 8
    return a.pos.x, a.pos.y, a.pos.x+dx-1, a.pos.y+dy-1
  end
end

--[[
playing with haskell type signatures:
pset        :: io ()
game_update :: btn_state -> game -> game
]]
__gfx__
00000000eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010100000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010101010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
