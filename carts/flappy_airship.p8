pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- https://itch.io/jam/retro-platformer-jam

--[[

  todo:

    - [ ] parallax scrolling
    - [ ] curried text functions

]]

--
-- game loop.
--

do
  local g

  function _init()
    g = game()
  end

  function _update60()
    g = game_update(g)
  end

  function _draw()
    game_draw(g)
  end
end

--
-- game entity.
--

-- game :: game
function game()
  return {
    airship = airship()
  }
end

-- game_update :: game -> game
function game_update(g)
  g.airship = airship_update(g.airship)
  return g
end

-- game_draw :: game -> io ()
function game_draw(g)
  cls(13)
  airship_draw(g.airship)
end

--
-- vec2 util.
--

-- vec2 :: float -> float -> vec2
function vec2(x, y)
  return {
    x = x or 0,
    y = y or 0,
  }
end

-- vec2_print :: vec2 :: io ()
function vec2_print(v)
  print(v.x .. ', ' .. v.y)
end

-- vec2_add_to :: vec2 -> vec2 -> ?
function vec2_add_to(a, b)
  local ax, ay = a.x, a.y
  local bx, by = b.x, b.y
  b.x = ax + bx
  b.y = ay + by
end

-- vec2_clamp :: vec2 -> vec2 -> vec2 -> ?
function vec2_clamp_between(v, lower, upper)
  local lx, ly = lower.x, lower.y
  local vx, vy = v.x, v.y
  local ux, uy = upper.x, upper.y
  v.x = clamp_between(vx, lx, ux)
  v.y = clamp_between(vy, ly, uy)
end

--
-- clamp util.
--

-- clamp :: float -> float -> float -> float
function clamp_between(n, lower, upper)
  return min(max(lower, n), upper)
end

--
-- airship entity.
--

-- airship :: airship
function airship()
  return {
    pos     = vec2(),
    vel     = vec2(),
    acc     = vec2(0, .01),
    max_vel = vec2(2, .25),
    min_vel = vec2(-2, -2),

    sx = 16,
    sy = 0,
    sw = 29,
    sh = 20,
  }
end

-- airship_update :: airship -> airship
function airship_update(a)
  vec2_add_to(a.acc, a.vel)
  vec2_clamp_between(a.vel, a.min_vel, a.max_vel)
  -- vec2_add_to(a.vel, a.pos)
  return a
end

-- airship_draw :: airship -> io ()
function airship_draw(a)
  sspr(a.sx, a.sy, a.sw, a.sh, a.pos.x, a.pos.y, a.sw*2, a.sh*2)
end
__gfx__
00000000eeeeeeee0000eeeeeeeeeeeeeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeee000e000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeeeeee00e00000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeeeeeee0e00000eeeeeeeeeeeee0000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeeeeeeee000000eeeeeeeeeeeee00000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeeeeeee000000eeeeeeeeeeeee00000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeeee000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeeee000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e000000000000000000000eeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e0000eeeeeee000eee0000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e0000eeeeeee000eee0000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e000000000000000000000ee0000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000e0000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000e000000000eeeeee00000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000e00000000eeeeee0000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000eeeeeeeeeeeeeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010100000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010101010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
